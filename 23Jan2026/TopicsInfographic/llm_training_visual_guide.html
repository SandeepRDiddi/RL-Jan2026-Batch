<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Training Pipeline: Visual Learning Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0f766e;
            --primary-light: #14b8a6;
            --secondary: #7c3aed;
            --accent: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg-dark: #0f172a;
            --bg-light: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3a 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 0.8s ease-out;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            letter-spacing: -1px;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Pipeline Overview */
        .pipeline-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 80px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .stage-card {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border-left: 6px solid var(--primary-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stage-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.2);
        }

        .stage-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary));
        }

        .stage-number {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .stage-card h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--gray-900);
        }

        .stage-card p {
            color: var(--text-light);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .key-metric {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: var(--gray-50);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }

        .metric-label {
            font-weight: 600;
            color: var(--gray-900);
            min-width: 100px;
        }

        .metric-value {
            color: var(--primary-light);
            font-weight: 700;
        }

        /* Interactive Demo */
        .demo-section {
            background: var(--bg-light);
            border-radius: 16px;
            padding: 50px;
            margin-bottom: 80px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .demo-section h2 {
            font-size: 2.5rem;
            margin-bottom: 50px;
            color: var(--gray-900);
            text-align: center;
            position: relative;
            padding-bottom: 20px;
        }

        .demo-section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary));
            border-radius: 2px;
        }

        /* Stage 1: Pretraining Demo */
        .pretraining-demo {
            display: grid;
            gap: 40px;
        }

        .example-block {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border-radius: 12px;
            padding: 30px;
            border: 2px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .example-block:hover {
            border-color: var(--primary-light);
            box-shadow: 0 10px 30px rgba(20, 184, 166, 0.1);
        }

        .example-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 12px;
        }

        .example-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
        }

        .example-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .example-content {
            display: grid;
            gap: 15px;
        }

        .input-output-pair {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .input-output-pair {
                grid-template-columns: 1fr;
            }
        }

        .input-box, .output-box {
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .input-box {
            background: #eff6ff;
            border-left-color: #3b82f6;
        }

        .input-label {
            font-weight: 700;
            color: #1e40af;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .input-text {
            color: var(--text);
            font-style: italic;
            font-size: 0.95rem;
        }

        .output-box {
            background: #ecfdf5;
            border-left-color: var(--success);
            position: relative;
        }

        .output-label {
            font-weight: 700;
            color: #065f46;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .predicted-token {
            font-weight: 700;
            color: var(--success);
            font-size: 1.1rem;
        }

        .probability-bar {
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .probability-label {
            font-size: 0.85rem;
            color: var(--text-light);
            min-width: 50px;
        }

        .bar-container {
            flex: 1;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--primary-light) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .probability-value {
            font-weight: 700;
            color: var(--success);
            min-width: 40px;
            text-align: right;
            font-size: 0.9rem;
        }

        .learning-insight {
            background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%);
            border-left: 4px solid var(--accent);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #78350f;
        }

        .learning-insight strong {
            display: block;
            margin-bottom: 5px;
            color: #92400e;
        }

        /* The Safety Gap Visualization */
        .safety-gap-demo {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 3px solid #ef4444;
            border-radius: 12px;
            padding: 30px;
            margin-top: 40px;
            position: relative;
            overflow: hidden;
        }

        .safety-gap-demo::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3rem;
            opacity: 0.3;
        }

        .safety-gap-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #991b1b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .safety-concern {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ef4444;
        }

        .concern-label {
            font-weight: 700;
            color: #991b1b;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .concern-text {
            color: var(--text);
            font-size: 0.95rem;
        }

        /* Interactive Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            box-shadow: 0 4px 15px rgba(20, 184, 166, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(20, 184, 166, 0.4);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-900);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--gray-200);
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: transparent;
            color: var(--text-light);
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .tab-button:hover {
            color: var(--primary-light);
        }

        .tab-button.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        /* Comparison Tables */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .comparison-table thead {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
        }

        .comparison-table th, .comparison-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .comparison-table tbody tr:hover {
            background: var(--gray-50);
        }

        .comparison-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .stat-box {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-top: 30px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            display: block;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-top: 8px;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 80px;
            padding: 30px;
            color: var(--text-light);
            animation: fadeInUp 0.8s ease-out 0.6s both;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--bg-light);
            margin: 5% auto;
            padding: 40px;
            border-radius: 16px;
            max-width: 700px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.3s ease;
        }

        .modal-close {
            color: var(--text-light);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--gray-900);
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 20px;
        }

        .modal-text {
            color: var(--text-light);
            line-height: 1.8;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† The LLM Training Pipeline</h1>
            <p class="subtitle">A comprehensive visual guide to understanding how language models learn, improve, and become aligned with human values</p>
        </header>

        <!-- Pipeline Overview -->
        <section class="pipeline-overview">
            <div class="stage-card" onclick="scrollToSection('stage1')">
                <div class="stage-number">1</div>
                <h2>Pretraining</h2>
                <p>Foundation building through next-token prediction on billions of tokens</p>
                <div class="key-metric">
                    <span class="metric-label">Duration:</span>
                    <span class="metric-value">Weeks to Months</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Data:</span>
                    <span class="metric-value">Billions of tokens</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Problem Solved:</span>
                    <span class="metric-value">Language Competence</span>
                </div>
            </div>

            <div class="stage-card" onclick="scrollToSection('stage2')">
                <div class="stage-number">2</div>
                <h2>Supervised Fine-Tuning</h2>
                <p>Teaching specific behaviors through curated instruction-response pairs</p>
                <div class="key-metric">
                    <span class="metric-label">Duration:</span>
                    <span class="metric-value">Days to Weeks</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Data:</span>
                    <span class="metric-value">10k-100k pairs</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Problem Solved:</span>
                    <span class="metric-value">Instruction Following</span>
                </div>
            </div>

            <div class="stage-card" onclick="scrollToSection('stage3')">
                <div class="stage-number">3</div>
                <h2>RLHF (Alignment)</h2>
                <p>Aligning model with nuanced human values through preference learning</p>
                <div class="key-metric">
                    <span class="metric-label">Duration:</span>
                    <span class="metric-value">Weeks</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Data:</span>
                    <span class="metric-value">5k-50k preferences</span>
                </div>
                <div class="key-metric">
                    <span class="metric-label">Problem Solved:</span>
                    <span class="metric-value">Human Alignment</span>
                </div>
            </div>
        </section>

        <!-- Stage 1: Pretraining Deep Dive -->
        <section class="demo-section" id="stage1">
            <h2>Stage 1: Pretraining - Foundation Building</h2>

            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab(event, 'pretrain-concept')">Concept</button>
                <button class="tab-button" onclick="switchTab(event, 'pretrain-examples')">Examples</button>
                <button class="tab-button" onclick="switchTab(event, 'pretrain-limitations')">Limitations</button>
            </div>

            <!-- Concept Tab -->
            <div id="pretrain-concept" class="tab-content active">
                <div class="pretraining-demo">
                    <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <h3 style="color: #1e40af; font-size: 1.3rem; margin-bottom: 15px;">üìä Next-Token Prediction: The Core Mechanism</h3>
                        <p style="color: #1e40af; font-size: 0.95rem; line-height: 1.8;">
                            <strong>The Mathematical Objective:</strong><br>
                            Loss = -E[Œ£ log P<sub>Œ∏</sub>(w<sub>t</sub> | w<sub>1</sub>,...,w<sub>t-1</sub>)]<br><br>
                            <strong>In Plain English:</strong><br>
                            The model learns a probability distribution P(next_token | previous_tokens) by predicting the next token billions of times across different contexts. This teaches it statistical relationships in language‚Äîwhat tokens naturally follow what patterns.
                        </p>
                    </div>

                    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #10b981; margin-top: 20px;">
                        <h3 style="color: #065f46; font-size: 1.3rem; margin-bottom: 15px;">‚ú® What Emerges From Pretraining</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                <strong style="color: #065f46;">Language Understanding</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Grammar, syntax, semantic relationships</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                <strong style="color: #065f46;">Reasoning Abilities</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Logic chains, problem-solving patterns</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                <strong style="color: #065f46;">Domain Knowledge</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Facts about medicine, math, history, etc.</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                                <strong style="color: #065f46;">Pattern Recognition</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Statistical correlations from data</span>
                            </div>
                        </div>
                    </div>

                    <div class="stat-box">
                        <span class="stat-number">Billions</span>
                        <span class="stat-label">Training Examples | Scale Teaches Patterns</span>
                    </div>
                </div>
            </div>

            <!-- Examples Tab -->
            <div id="pretrain-examples" class="tab-content">
                <div class="pretraining-demo">
                    <!-- Example 1 -->
                    <div class="example-block">
                        <div class="example-header">
                            <div class="example-icon">1Ô∏è‚É£</div>
                            <div class="example-title">Symptom ‚Üí Diagnosis Pattern</div>
                        </div>
                        <div class="example-content">
                            <div class="input-output-pair">
                                <div class="input-box">
                                    <div class="input-label">üìù Clinical Context</div>
                                    <div class="input-text">Patient reports fever, body aches, and fatigue for 3 days.</div>
                                </div>
                                <div class="output-box">
                                    <div class="output-label">üéØ Predicted Next Token</div>
                                    <div class="predicted-token">likely viral</div>
                                    <div class="probability-bar">
                                        <span class="probability-label">Prob:</span>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: 84%;"></div>
                                        </div>
                                        <span class="probability-value">84%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="learning-insight">
                                <strong>What Model Learns:</strong>
                                Statistical correlation: fever + aches + fatigue ‚Üí likely viral infection. This is NOT understanding causality‚Äîit's recognizing patterns that frequently appear together in medical texts.
                            </div>
                        </div>
                    </div>

                    <!-- Example 2 -->
                    <div class="example-block">
                        <div class="example-header">
                            <div class="example-icon">2Ô∏è‚É£</div>
                            <div class="example-title">Drug Interaction Pattern</div>
                        </div>
                        <div class="example-content">
                            <div class="input-output-pair">
                                <div class="input-box">
                                    <div class="input-label">üíä Drug Context</div>
                                    <div class="input-text">Patient on warfarin (anticoagulant). Prescribing aspirin will cause</div>
                                </div>
                                <div class="output-box">
                                    <div class="output-label">üéØ Predicted Next Token</div>
                                    <div class="predicted-token">bleeding risk</div>
                                    <div class="probability-bar">
                                        <span class="probability-label">Prob:</span>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: 87%;"></div>
                                        </div>
                                        <span class="probability-value">87%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="learning-insight">
                                <strong>What Model Learns:</strong>
                                Pattern association: warfarin + aspirin ‚Üí bleeding risk. The model doesn't understand anticoagulation mechanisms‚Äîit's learned this token sequence is common in medical literature.
                            </div>
                        </div>
                    </div>

                    <!-- Example 3 -->
                    <div class="example-block">
                        <div class="example-header">
                            <div class="example-icon">3Ô∏è‚É£</div>
                            <div class="example-title">Lab Value Interpretation</div>
                        </div>
                        <div class="example-content">
                            <div class="input-output-pair">
                                <div class="input-box">
                                    <div class="input-label">üß™ Lab Context</div>
                                    <div class="input-text">Blood glucose > 126 mg/dL (fasting) suggests</div>
                                </div>
                                <div class="output-box">
                                    <div class="output-label">üéØ Predicted Next Token</div>
                                    <div class="predicted-token">diabetes mellitus</div>
                                    <div class="probability-bar">
                                        <span class="probability-label">Prob:</span>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: 82%;"></div>
                                        </div>
                                        <span class="probability-value">82%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="learning-insight">
                                <strong>What Model Learns:</strong>
                                Statistical fact: High fasting glucose ‚Üí diabetes mention. Learns this association from thousands of clinical documents.
                            </div>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 25px; border-radius: 12px; margin-top: 30px; border-left: 4px solid #a78bfa;">
                        <h3 style="color: #581c87; margin-bottom: 15px;">üìà Pattern Summary: More Examples Trained</h3>
                        <ul style="list-style: none; color: #581c87;">
                            <li>‚úì Dosing adjustments in renal impairment (Example 6)</li>
                            <li>‚úì Pregnancy-drug contraindications (Example 7)</li>
                            <li>‚úì CYP enzyme inhibition interactions (Example 9)</li>
                            <li>‚úì Pharmacogenomics responses (Example 11)</li>
                            <li>‚úì Polypharmacy complications (Example 15)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Limitations Tab -->
            <div id="pretrain-limitations" class="tab-content">
                <div style="display: grid; gap: 25px;">
                    <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <h3 style="color: #991b1b; font-size: 1.3rem; margin-bottom: 15px;">‚ö†Ô∏è Problem 1: No Value Alignment</h3>
                        <p style="color: #991b1b; margin-bottom: 15px;">The model learns to match internet text patterns‚Äîwhich include:</p>
                        <ul style="list-style: none; color: #991b1b; padding-left: 0;">
                            <li>‚ùå Misinformation from low-quality websites</li>
                            <li>‚ùå Toxic discussions and offensive content</li>
                            <li>‚ùå Outdated or inaccurate medical information</li>
                            <li>‚ùå Harmful instructions and dangerous advice</li>
                        </ul>
                    </div>

                    <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <h3 style="color: #991b1b; font-size: 1.3rem; margin-bottom: 15px;">‚ö†Ô∏è Problem 2: No Safety Awareness</h3>
                        <p style="color: #991b1b; margin-bottom: 15px;">If the statistically most likely token is harmful, the model generates it:</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #ef4444;">
                            <strong style="color: #991b1b;">Example:</strong><br>
                            <span style="color: var(--text); font-size: 0.9rem;">"How to overdose on medication" might be the high-probability continuation in contexts discussing self-harm on forums.</span>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <h3 style="color: #991b1b; font-size: 1.3rem; margin-bottom: 15px;">‚ö†Ô∏è Problem 3: No Instruction Following</h3>
                        <p style="color: #991b1b; margin-bottom: 15px;">The model just completes sequences‚Äîit doesn't understand user intent or respond to requests:</p>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 3px solid #ef4444;">
                            <strong style="color: #991b1b;">Example:</strong><br>
                            <span style="color: var(--text); font-size: 0.9rem;">Given "Q: What is the capital of France?", it continues with encyclopedia text rather than answering "A: Paris".</span>
                        </div>
                    </div>

                    <div class="safety-gap-demo">
                        <div class="safety-gap-title">üö® The Critical Safety Gap</div>
                        <div class="safety-concern">
                            <div class="concern-label">Pretraining Saw Pattern</div>
                            <div class="concern-text">"I took 500 aspirin pills and..." (from Reddit forum discussing overdose)</div>
                        </div>
                        <div class="safety-concern">
                            <div class="concern-label">High-Probability Continuation</div>
                            <div class="concern-text">"...woke up in the hospital" OR "...died" (60% combined probability)</div>
                        </div>
                        <div class="safety-concern" style="background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%); border-left-color: #991b1b;">
                            <div class="concern-label">The Problem</div>
                            <div class="concern-text"><strong>This is factually accurate but ethically problematic.</strong> The model has no way to refuse or warn about harm. Stage 2 and 3 training are needed to fix this.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stage 2: SFT -->
        <section class="demo-section" id="stage2">
            <h2>Stage 2: Supervised Fine-Tuning (SFT)</h2>

            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #f59e0b; margin-bottom: 30px;">
                <h3 style="color: #92400e; margin-bottom: 15px;">üéì What SFT Does</h3>
                <p style="color: #92400e; margin-bottom: 15px;">
                    Takes the pretrained model and teaches it specific behaviors through <strong>behavioral imitation</strong>. Instead of predicting the next token in any text, it learns to follow instructions and produce well-formatted responses.
                </p>
                <p style="color: #92400e;">
                    <strong>Key Insight:</strong> SFT is limited by the quality and diversity of the curated dataset. If you don't have an example of something in your training data, the model likely won't do it well.
                </p>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>After Pretraining</th>
                        <th>After SFT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Response to Questions</strong></td>
                        <td>Rambles or continues encyclopedia text</td>
                        <td>Answers concisely with "Q: ... A: ..." format</td>
                    </tr>
                    <tr>
                        <td><strong>Instruction Following</strong></td>
                        <td>Ignores instructions</td>
                        <td>Follows most explicit instructions</td>
                    </tr>
                    <tr>
                        <td><strong>Refusal</strong></td>
                        <td>No refusal capability</td>
                        <td>Basic refusal for obviously harmful requests</td>
                    </tr>
                    <tr>
                        <td><strong>Data Needed</strong></td>
                        <td>Billions of tokens</td>
                        <td>10k-100k curated pairs</td>
                    </tr>
                    <tr>
                        <td><strong>Training Time</strong></td>
                        <td>Weeks to months</td>
                        <td>Days to weeks</td>
                    </tr>
                </tbody>
            </table>

            <div class="example-block" style="margin-top: 40px;">
                <div class="example-header">
                    <div class="example-icon">üìö</div>
                    <div class="example-title">SFT Example: Teaching Format & Instruction Following</div>
                </div>
                <div class="example-content">
                    <div class="input-output-pair">
                        <div class="input-box">
                            <div class="input-label">üìù Instruction (SFT Training Data)</div>
                            <div class="input-text">You are a clinical pharmacist. A patient is taking warfarin and asks if aspirin is safe. Provide a concise answer.</div>
                        </div>
                        <div class="output-box">
                            <div class="output-label">‚úÖ Desired Response (Expert Label)</div>
                            <div class="input-text" style="color: #065f46;">No, aspirin is contraindicated with warfarin due to increased bleeding risk. Both inhibit platelet function and coagulation. Recommend acetaminophen instead.</div>
                        </div>
                    </div>
                    <div class="learning-insight">
                        <strong>SFT Training:</strong> The model learns "when given this instruction, produce this specific response format and content." It's behavioral imitation‚Äîmirroring expert examples.
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #3b82f6; margin-top: 30px;">
                <h3 style="color: #1e40af; margin-bottom: 15px;">‚öôÔ∏è SFT Limitations</h3>
                <ul style="list-style: none; color: #1e40af;">
                    <li>üìä <strong>Dataset-Bound:</strong> Can only learn behaviors shown in training data</li>
                    <li>üîÑ <strong>No Preference Learning:</strong> Can't distinguish between "good" and "better" responses</li>
                    <li>üéØ <strong>Quality Ceiling:</strong> Limited by the quality of curated expert examples</li>
                    <li>‚ö° <strong>No Nuance:</strong> Can't capture subtle human preference tradeoffs</li>
                </ul>
            </div>
        </section>

        <!-- Stage 3: RLHF -->
        <section class="demo-section" id="stage3">
            <h2>Stage 3: RLHF (Reinforcement Learning From Human Feedback)</h2>

            <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 30px;">
                <h3 style="color: #065f46; margin-bottom: 15px;">üéØ What RLHF Does</h3>
                <p style="color: #065f46; margin-bottom: 15px;">
                    Goes beyond imitation to capture preferences that can't be explicitly demonstrated. Instead of showing the "right answer," humans compare responses and say "A is better than B." The model learns to predict these preferences and optimizes accordingly.
                </p>
                <p style="color: #065f46;">
                    <strong>Key Insight:</strong> RLHF can capture nuanced tradeoffs‚Äîlike being helpful while being safe, or being creative while being accurate.
                </p>
            </div>

            <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #a78bfa; margin-bottom: 30px;">
                <h3 style="color: #581c87; margin-bottom: 20px;">üîÑ Two-Step RLHF Process</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #a78bfa;">
                        <strong style="color: #581c87; font-size: 1.1rem;">Step A: Reward Model</strong>
                        <p style="color: var(--text-light); margin-top: 10px; font-size: 0.9rem;">
                            Train a neural network on human preferences: "Given response A and B, which is better?"<br><br>
                            Output: A reward score for any response.
                        </p>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #a78bfa;">
                        <strong style="color: #581c87; font-size: 1.1rem;">Step B: Policy Optimization</strong>
                        <p style="color: var(--text-light); margin-top: 10px; font-size: 0.9rem;">
                            Use the reward model to optimize the LLM policy via RL (typically PPO algorithm).<br><br>
                            Goal: Maximize reward while staying close to SFT model.
                        </p>
                    </div>
                </div>
            </div>

            <div class="example-block">
                <div class="example-header">
                    <div class="example-icon">üè•</div>
                    <div class="example-title">RLHF Example: Drug Safety Preference</div>
                </div>
                <div class="example-content">
                    <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <div class="input-label">‚ùì User Query</div>
                        <div class="input-text">Can I take ibuprofen with my warfarin?</div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 700; color: #1e40af; margin-bottom: 10px;">Response Option A:</div>
                        <div style="background: #ecfdf5; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <span style="color: var(--text);">Ibuprofen can increase bleeding risk when combined with warfarin because both affect platelet function. I recommend consulting your pharmacist or doctor before taking this combination. Safer alternatives like acetaminophen are available.</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div style="font-weight: 700; color: #3b82f6; margin-bottom: 10px;">Response Option B:</div>
                        <div style="background: #dbeafe; padding: 15px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <span style="color: var(--text);">No, ibuprofen interacts with warfarin and increases bleeding risk significantly.</span>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%); padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                        <strong style="color: #92400e;">Human Preference in RLHF Training:</strong>
                        <p style="color: #92400e; margin-top: 8px; font-size: 0.9rem;">
                            Humans rate Option A as better because it: (1) explains WHY, (2) recommends consulting professionals, (3) suggests alternatives. Option B is accurate but incomplete. RLHF learns this preference and optimizes toward it.
                        </p>
                    </div>

                    <div class="learning-insight" style="margin-top: 20px;">
                        <strong>What RLHF Captures:</strong>
                        This nuance‚Äîsafety + helpfulness + transparency‚Äîcan't be demonstrated in a single SFT example. Humans have to compare responses to express it. RLHF makes the model optimize for this implicit preference.
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 30px; border-radius: 12px; border-left: 4px solid #10b981; margin-top: 40px;">
                <h3 style="color: #065f46; margin-bottom: 20px;">‚úÖ What RLHF Achieves</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <strong style="color: #065f46;">‚úì Helpfulness</strong><br>
                        <span style="color: var(--text-light); font-size: 0.9rem;">Balanced with safety</span>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <strong style="color: #065f46;">‚úì Harmlessness</strong><br>
                        <span style="color: var(--text-light); font-size: 0.9rem;">Refuses dangerous requests</span>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <strong style="color: #065f46;">‚úì Honesty</strong><br>
                        <span style="color: var(--text-light); font-size: 0.9rem;">Admits uncertainty</span>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #10b981;">
                        <strong style="color: #065f46;">‚úì Nuance</strong><br>
                        <span style="color: var(--text-light); font-size: 0.9rem;">Complex preference tradeoffs</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Comprehensive Comparison -->
        <section class="demo-section">
            <h2>Three Stages: Side-by-Side Comparison</h2>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Dimension</th>
                        <th>Pretraining</th>
                        <th>SFT</th>
                        <th>RLHF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Primary Objective</strong></td>
                        <td>Next-token prediction</td>
                        <td>Behavioral imitation</td>
                        <td>Preference optimization</td>
                    </tr>
                    <tr>
                        <td><strong>Data Required</strong></td>
                        <td>Billions of raw tokens</td>
                        <td>10k-100k instruction pairs</td>
                        <td>5k-50k preference comparisons</td>
                    </tr>
                    <tr>
                        <td><strong>Problem Solved</strong></td>
                        <td>Language competence</td>
                        <td>Instruction following</td>
                        <td>Value alignment</td>
                    </tr>
                    <tr>
                        <td><strong>Training Duration</strong></td>
                        <td>Weeks to months</td>
                        <td>Days to weeks</td>
                        <td>Weeks</td>
                    </tr>
                    <tr>
                        <td><strong>Key Limitation</strong></td>
                        <td>No alignment, no safety</td>
                        <td>Dataset-limited, no preference learning</td>
                        <td>Expensive to scale, requires diverse feedback</td>
                    </tr>
                    <tr>
                        <td><strong>Model Capability</strong></td>
                        <td>Encyclopedia-like completions</td>
                        <td>Answers questions, follows formats</td>
                        <td>Safe, helpful, nuanced responses</td>
                    </tr>
                </tbody>
            </table>

            <div class="stat-box" style="margin-top: 40px;">
                <span class="stat-number">3 Stages</span>
                <span class="stat-label">Each essential, each solving different problems</span>
            </div>
        </section>

        <!-- Key Takeaways -->
        <section class="demo-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%); border-left: 6px solid #f59e0b;">
            <h2 style="color: #92400e;">üéì Key Takeaways</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 30px;">
                <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <strong style="color: #92400e; display: block; margin-bottom: 10px;">1. Why Three Stages?</strong>
                    <p style="color: var(--text); font-size: 0.95rem;">
                        No single approach creates effective, aligned LLMs. Each stage solves different fundamental problems: pretraining teaches language, SFT teaches behavior, RLHF teaches values.
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <strong style="color: #92400e; display: block; margin-bottom: 10px;">2. Pretraining Isn't Enough</strong>
                    <p style="color: var(--text); font-size: 0.95rem;">
                        A pretrained model matches internet patterns‚Äîincluding misinformation, toxicity, and harmful content. It has no safety awareness or refusal capability.
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <strong style="color: #92400e; display: block; margin-bottom: 10px;">3. SFT Has Limits</strong>
                    <p style="color: var(--text); font-size: 0.95rem;">
                        SFT teaches instruction-following but is limited by dataset diversity. Nuanced preferences (safe AND helpful) can't be explicitly demonstrated.
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                    <strong style="color: #92400e; display: block; margin-bottom: 10px;">4. RLHF Completes the Picture</strong>
                    <p style="color: var(--text); font-size: 0.95rem;">
                        RLHF captures preference comparisons that express complex, implicit values. This is how models learn nuanced alignment with human values.
                    </p>
                </div>
            </div>
        </section>

        <!-- Interactive Visualization -->
        <section class="demo-section">
            <h2>Interactive: Explore Response Evolution</h2>

            <div style="margin-top: 30px;">
                <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.95rem;">
                    <strong>Scenario:</strong> User asks "Is Metformin safe for diabetic patients with kidney disease?"
                </p>

                <div style="display: grid; gap: 20px;">
                    <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 25px; border-radius: 12px; border-left: 4px solid #ef4444;">
                        <div style="font-weight: 700; color: #991b1b; margin-bottom: 10px;">‚ùå After Pretraining Only</div>
                        <div style="background: white; padding: 15px; border-radius: 8px; color: var(--text); font-size: 0.9rem;">
                            Metformin and kidney disease involve complex pharmacokinetics. The kidneys are responsible for 80-90% of metformin excretion. Renal impairment reduces clearance. Type 2 diabetes is associated with microvascular and macrovascular complications. The UKPDS study showed...
                        </div>
                        <div style="color: #991b1b; font-size: 0.85rem; margin-top: 10px;">
                            ‚ö†Ô∏è <strong>Problem:</strong> Continues like Wikipedia. Doesn't directly answer the question. No safety awareness.
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 25px; border-radius: 12px; border-left: 4px solid #3b82f6;">
                        <div style="font-weight: 700; color: #1e40af; margin-bottom: 10px;">‚ö†Ô∏è After SFT</div>
                        <div style="background: white; padding: 15px; border-radius: 8px; color: var(--text); font-size: 0.9rem;">
                            Metformin is generally contraindicated in patients with eGFR less than 30 mL/min. For eGFR 30-60, dose reduction is recommended. Consult with a doctor before taking metformin if you have kidney disease.
                        </div>
                        <div style="color: #1e40af; font-size: 0.85rem; margin-top: 10px;">
                            ‚úì <strong>Better:</strong> Answers directly, follows format. ‚ö†Ô∏è <strong>Still Limited:</strong> Doesn't explain the WHY or capture nuance between "avoid" and "dose-adjust" based on severity.
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 25px; border-radius: 12px; border-left: 4px solid #10b981;">
                        <div style="font-weight: 700; color: #065f46; margin-bottom: 10px;">‚úÖ After RLHF</div>
                        <div style="background: white; padding: 15px; border-radius: 8px; color: var(--text); font-size: 0.9rem;">
                            Metformin safety with kidney disease depends on kidney function severity. For eGFR > 60: likely safe with standard dosing. For eGFR 30-60: dose reduction recommended, monitor kidney function regularly. For eGFR < 30: generally contraindicated due to lactic acidosis risk. <strong>Most importantly, this decision requires consultation with your healthcare provider who can assess your individual risk factors.</strong>
                        </div>
                        <div style="color: #065f46; font-size: 0.85rem; margin-top: 10px;">
                            ‚úì <strong>Excellent:</strong> Answers clearly, explains criteria, emphasizes caution, recommends professional consultation. Balances helpfulness with safety.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <p>üìö This visual guide demonstrates the three-stage pipeline using pharmaceutical examples for clarity and relevance.</p>
            <p style="margin-top: 20px; font-size: 0.9rem;">Created for educational purposes ‚Ä¢ Understanding LLM training fundamentals</p>
        </footer>
    </div>

    <script>
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function switchTab(event, tabId) {
            event.preventDefault();
            
            // Hide all tabs
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remove active from all buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Smooth scroll for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Add animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.example-block, .stage-card').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            observer.observe(el);
        });
    </script>
</body>
</html>
